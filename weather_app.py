# -*- coding: utf-8 -*-
"""Weather_app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1TeTdCBvtpwda9f0PGjwiR7w7GB7_3sUD
"""

import streamlit as st
import requests
import matplotlib.pyplot as plt

# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="Open-Meteo Weather App", page_icon="ğŸŒ¦ï¸", layout="centered")

st.title("ğŸŒ¦ï¸ Open-Meteo ì‹¤ì‹œê°„ ë‚ ì”¨ ì•±")
st.caption("API í‚¤ ì—†ì´ ì „ ì„¸ê³„ ì‹¤ì‹œê°„ ë‚ ì”¨ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ğŸŒ")

# ğŸ”¹ ë„ì‹œ ì„ íƒ
city = st.selectbox(
    "ë„ì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”",
    ["Seoul", "Busan", "Tokyo", "New York", "London"]
)

# ğŸ”¹ ê° ë„ì‹œì˜ ìœ„ë„/ê²½ë„ (Open-MeteoëŠ” ì¢Œí‘œ ê¸°ë°˜)
locations = {
    "Seoul": {"lat": 37.5665, "lon": 126.9780},
    "Busan": {"lat": 35.1796, "lon": 129.0756},
    "Tokyo": {"lat": 35.6764, "lon": 139.6500},
    "New York": {"lat": 40.7128, "lon": -74.0060},
    "London": {"lat": 51.5072, "lon": -0.1276}
}

# ğŸ”¹ ì„ íƒí•œ ë„ì‹œ ì¢Œí‘œ
lat = locations[city]["lat"]
lon = locations[city]["lon"]

# ğŸ”¹ Open-Meteo API URL
url = f"https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current_weather=true"

# ğŸ”¹ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì‹¤í–‰
if st.button("ë‚ ì”¨ ë¶ˆëŸ¬ì˜¤ê¸°"):
    response = requests.get(url)

    if response.status_code == 200:
        data = response.json()
        current = data["current_weather"]

        temp = current["temperature"]
        windspeed = current["windspeed"]
        weather_code = current["weathercode"]

        # ë‚ ì”¨ ì½”ë“œ ì°¸ê³ í‘œ ê°„ë‹¨ ë§¤í•‘
        weather_map = {
            0: "ë§‘ìŒ â˜€ï¸",
            1: "ëŒ€ì²´ë¡œ ë§‘ìŒ ğŸŒ¤",
            2: "ì•½ê°„ êµ¬ë¦„ â˜ï¸",
            3: "íë¦¼ â˜ï¸â˜ï¸",
            45: "ì•ˆê°œ ğŸŒ«",
            48: "ì•ˆê°œ ğŸŒ«",
            51: "ì•½í•œ ë¹„ ğŸŒ¦",
            61: "ë¹„ â˜”ï¸",
            71: "ëˆˆ â„ï¸",
        }

        weather_desc = weather_map.get(weather_code, "ê¸°íƒ€")

        st.subheader(f"ğŸ“ {city}ì˜ í˜„ì¬ ë‚ ì”¨")
        st.metric("ê¸°ì˜¨ (Â°C)", f"{temp}Â°C")
        st.metric("í’ì† (m/s)", windspeed)
        st.write(f"ë‚ ì”¨ ìƒíƒœ: {weather_desc}")

        # ì‹œê°í™” (ê¸°ì˜¨ & í’ì†)
        fig, ax = plt.subplots()
        ax.bar(["Temperature", "Windspeed"], [temp, windspeed], color=["#FFB6C1", "#87CEFA"])
        ax.set_title(f"Weather Data - {city}")
        st.pyplot(fig)

    else:
        st.error(f"âŒ ìš”ì²­ ì‹¤íŒ¨: {response.status_code}")